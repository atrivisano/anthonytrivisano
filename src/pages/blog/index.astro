---
import { getCollection } from 'astro:content';
import BlogHero from '../../components/blog/BlogHero.astro';
import FeaturedPost from '../../components/blog/FeaturedPost.astro';
import PostGrid from '../../components/blog/PostGrid.astro';
import NewsletterSignup from '../../components/blog/NewsletterSignup.astro';
import CategoryCloud from '../../components/blog/CategoryCloud.astro';
import MainLayout from "../../layouts/MainLayout.astro";

// Get all blog posts and sort by date (newest first)
const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

// Extract all unique categories for the filter
const allCategories = [...new Set(posts.flatMap(post => post.data.categories || []))];

// SEO metadata
const title = 'Blog | Anthony Trivisano';
const description = 'Insights on API development, digital transformation, team leadership, data security, and database optimization from a seasoned developer and technical leader.';
---

<MainLayout title={title} description={description}>
	<!-- Hero Section -->
	<BlogHero
		title="Insights & Expertise"
		description="Sharing professional insights on web development, leadership, security, and digital transformation. Explore practical advice based on real-world experience."
		categories={allCategories}
	/>

	<main class="container mx-auto px-4 py-12">
		<!-- Featured Post Section -->
		{posts.length > 0 && <FeaturedPost post={posts[0]} />}

		<!-- All Posts Section -->
		<PostGrid
			posts={posts}
			startIndex={1}
		/>

		<!-- Newsletter Signup Section -->
		<NewsletterSignup />

		<!-- Categories/Topics Cloud Section -->
		<CategoryCloud
			categories={allCategories}
		/>
	</main>
</MainLayout>